function redraw(){context.clearRect(0,0,canvas.width,canvas.height);for(var e=circleRadius,t=penSize,n=0;n<undo.length;n++){var c=undo[n],r=c[0];switch(r){case"drawing":redrawDrawing(c);break;case"circle":redrawCircle(c);break;case"pensize":setPenSize(c[1],1);break;case"circleradius":setCircleRadius(c[1],1);break;case"rectangle":redrawRectangle(c);break;case"rectangleheight":setRectangleHeight(c[1],1);break;case"rectanglewidth":setRectangleWidth(c[1],1);break;case"text":redrawText(c)}}setPenSize(t,1),setCircleRadius(e,1)}function redrawCircle(e){context.beginPath(),context.arc(e[1],e[2],circleRadius,0,2*Math.PI),context.stroke(),context.beginPath()}function redrawRectangle(e){context.beginPath(),context.rect(e[1],e[2],recWidth,recHeight),context.stroke(),context.beginPath()}function redrawDrawing(e){var t=e[1];context.moveTo(t[0][0],t[0][1]);for(var n=0;n<t.length;n++){var c=t[n][0],r=t[n][1];context.lineTo(c,r),context.stroke(),context.arc(c,r,penSize,0,2*Math.PI),context.fill(),context.beginPath(),context.moveTo(c,r)}context.beginPath()}function redrawText(e){context.fillText(e[1],e[2],e[3])}function undo1(){if(undo.length>0){var e=undo.pop();settingNames.includes(e[0])&&undo1(),redo.push(e),redraw()}}function redo1(){if(redo.length>0){var e=redo.pop();settingNames.includes(e[0])&&redo1(),undo.push(e),redraw()}}function setCircleRadius(e,t){e>0&&(circleRadius=e),t||undo.push(new Array("circleradius",circleRadius))}function setRectangleWidth(e,t){e>0&&(recWidth=e),t||undo.push(new Array("rectanglewidth",recWidth))}function setRectangleHeight(e,t){e>0&&(recHeight=e),t||undo.push(new Array("rectangleheight",recHeight))}function setText(e){text=e}function setPenSize(e,t){e>0&&(penSize=e,context.lineWidth=2*penSize),t||undo.push(new Array("pensize",penSize))}function startDrawing(e){context.moveTo(e.clientX,e.clientY),lastDrawing.push(new Array(e.clientX,e.clientY)),draw=!0,mouseDraw(e)}function stopDrawing(e){draw&&(context.beginPath(),undo.push(new Array("drawing",lastDrawing)),lastDrawing=new Array,draw=!1)}function mouseDraw(e){draw&&(context.lineTo(e.clientX,e.clientY),lastDrawing.push(new Array(e.clientX,e.clientY)),context.stroke(),context.arc(e.clientX,e.clientY,penSize,0,2*Math.PI),context.fill(),context.beginPath(),context.moveTo(e.clientX,e.clientY))}function drawCircle(e){context.beginPath(),context.arc(e.clientX,e.clientY,circleRadius,0,2*Math.PI),undo.push(new Array("circle",e.clientX,e.clientY,circleRadius)),context.stroke(),context.beginPath()}function drawRectangle(e){context.beginPath(),context.rect(e.clientX,e.clientY,recWidth,recHeight),undo.push(new Array("rectangle",e.clientX,e.clientY,recWidth,recHeight)),context.stroke(),context.beginPath()}function drawText(e){context.fillText(text,e.clientX,e.clientY),undo.push(new Array("text",text,e.clientX,e.clientY))}function setFuncDrawing(){canvas.removeEventListener("mousedown",currentFunc),currentFunc=startDrawing,canvas.addEventListener("mousedown",currentFunc)}function setFuncCircle(){canvas.removeEventListener("mousedown",currentFunc),currentFunc=drawCircle,canvas.addEventListener("mousedown",currentFunc)}function setFuncRectangle(){canvas.removeEventListener("mousedown",currentFunc),currentFunc=drawRectangle,canvas.addEventListener("mousedown",currentFunc)}function setFuncText(){canvas.removeEventListener("mousedown",currentFunc),currentFunc=drawText,canvas.addEventListener("mousedown",currentFunc)}function setColour(e){context.fillStyle=e,context.strokeStyle=e;var t=document.getElementsByClassName("active");t&&(t.className="cSwitch")}function colourSwitch(e){var t=e.target;setColour(t.style.backgroundColor),t.className+=" active"}function saveImage(){var e=canvas.toDataURL(),t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.satus){t.responseText;window.open(e,"blank","location=0, menubar=0")}},t.open("POST","save.php",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("img="+e)}var canvas=document.getElementById("AmazingCanvas"),context=canvas.getContext("2d");context.font="30px Arial",canvas.width=window.innerWidth-6,canvas.height=window.innerHeight-220;var penSize=5,draw=!1,circleRadius=40,recHeight=40,recWidth=40,currentFunc=startDrawing,text="Hello, world!",settingNames=new Array("pensize","circleradius","rectangleheight","rectanglewidth");context.lineWidth=2*penSize;var undo=new Array,redo=new Array;undo.push(new Array("pensize",penSize)),undo.push(new Array("circleradius",circleRadius)),undo.push(new Array("rectanglewidth",recWidth)),undo.push(new Array("rectangleheight",recHeight));var lastDrawing=new Array;canvas.addEventListener("mousedown",currentFunc);var currentUp=stopDrawing;canvas.addEventListener("mouseup",currentUp);var currentMove=mouseDraw;canvas.addEventListener("mousemove",currentMove);for(var cSwitch1=document.getElementsByClassName("cSwitch"),i=0,j=cSwitch1.length;i<j;i++)cSwitch1[i].addEventListener("click",colourSwitch,!0);var gulp=require("gulp"),uglify=require("gulp-uglify"),concat=require("gulp-concat");gulp.task("default",function(){gulp.src("*.js").pipe(concat("aimfireapp.js")).pipe(uglify()).pipe(gulp.dest("build"))});